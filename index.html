<html>
<head>
    <title>Project 1: Zayo Opportunities</title>

    <!--Include CSS-->
    <link href="interaction.css" rel="stylesheet">
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Theme CSS -->
    <!-- Theme From: https://startbootstrap.com/template-overviews/freelancer/ -->
    <link href="freelancer.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.13/css/jquery.dataTables.css">
    <!-- reference to Leaflet CSS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" href="leaflet.awesome-markers.css">

    <!--Include JavaScript Files-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/jquery.dataTables.js"></script>
    <script src="uStates.js"></script> <!-- creates uStates. -->
    <script src="https://use.fontawesome.com/f78ead1096.js"></script>
    <!-- reference to Leaflet JavaScript -->
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="leaflet.awesome-markers.js"></script>

	<link rel="stylesheet" href="MarkerCluster.css" />
	<link rel="stylesheet" href="MarkerCluster.Default.css" />
	<script src="leaflet.markercluster-src.js"></script>
</head>
<body>
	<!-- Navigation Bar -->
    <nav id="mainNav" class="navbar navbar-default navbar-custom">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="#">Project 1: Insights in Zayo Data</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#"></a>
                    </li>
                    <li class="page-scroll">
                        <a href="#partOne">Profit</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#partTwo">Buildings</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#partThree">Part 3 &amp; 4</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#partFive">Part 5</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
	<div id="tooltip"></div><!-- div to hold tooltip. -->
	<div class='container'>
		<div id="partOne" class="row col-md-offset-1" >
			<h2>Profit Across States</h2>
            <svg width="960" height="600" id="statesvg"></svg> <!-- svg to hold the map. -->
        </div>
		<div class="row">
			<div id="tableDiv" class="col-md-12">
				<table id="profitTable" class="display"  width="100%"  ></table>
			</div>
	    </div>
	    <div id="partTwo" class="row col-md-offset-1">
	    	<h2>Building Across USA</h2>
	    	<div id="map"></div>
	    </div>
	</div>
	
	
	
	<script>

		function tooltipHtml(n, d){	/* function to create html content string in tooltip div. */
			return "<h4>"+n+"</h4><table>"+
			"<tr><td>Total Profit</td><td>"+parseFloat(d.totalProfit).toFixed(2)+"</td></tr>"+
			"<tr><td style='line-height:10px;'></td><td></td></tr>"+
			"<tr><td>Number of Buildings</td><td>"+(d.buildings)+"</td></tr>"+
			//"<tr><td>Min IBU</td><td>"+(d.high)+"</td></tr>"+
			"</table>";
		}

		var nums = d3.interpolateNumber(0, 1);

		var stateData ={};

	// Load in my states data!
	
	d3.csv("processedData/profit_by_state.csv", function(data) {
		color = d3.scaleLinear().domain([
			d3.min(data, function(d) {
				return parseFloat(d['Total Profit']);
			} ) - 1,
			d3.max(data, function(d) {
				return parseFloat(d['Total Profit']);
			} ) + 1]) 
		.interpolate(d3.interpolateHcl)
		.range([d3.rgb("#66ff33"), d3.rgb('#006600')]);
		

		// Loop through each state data value in the .csv file
		for (var i = 0; i < data.length; i++) {

			// Grab State Name
			stateData[data[i].State]={
				totalProfit: data[i]['Total Profit'],
				buildings: data[i]['Number of Buildings'],
				color: color(data[i]['Total Profit'])
			}
			if ( i === data.length-1){
				uStates.draw("#statesvg", stateData, tooltipHtml, populateDataTable);
				d3.select(self.frameElement).style("height", "600px"); 
			}
			//var dataState = data[i].state;

			
		}
	} );

	var dataTable = null
	function populateDataTable( state ){
		dataTableCSV = []
		columns = []
		d3.csv("processedData/profits.csv", function(data) {
			var headerNames = d3.keys(data[0]);
			for( var i in headerNames ){
				obj = { title: headerNames[i] };
				if ( headerNames[i] == 'Latitude' || headerNames[i] == 'Longitude' || headerNames[i] == 'State' || headerNames[i] == ''){
					obj['visible'] = false;
				}
				columns.push( obj )
			}

			for (var i = 0; i < data.length; i++) {
				if ( data[i].State === state ){
					var array = $.map(data[i], function(value, index) {
						return [value];
					});
					dataTableCSV.push( array );
				}
				if ( i === data.length-1){
					if (dataTable){
						dataTable.clear();
    					dataTable.rows.add(dataTableCSV);
    					dataTable.draw();	
					}
					else{
						dataTable = $('#profitTable').DataTable( {
							data: dataTableCSV,
							columns: columns
						} );
					}

					$('html, body').animate({scrollTop: $("#tableDiv").offset().top}, 2000);
					
				}	
			}
			
		} ); 
	}

	var map = L.map('map', {
		preferCanvas: true
	}).setView([36.264, -94.579], 5);
	L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);
	var redMarker = L.AwesomeMarkers.icon({
		prefix: 'fa',
    	icon: 'money',
    	markerColor: 'blue',
    	iconColor: 'black'
  	});
  	var yellowMarker = L.AwesomeMarkers.icon({
    	prefix: 'fa',
    	icon: 'wrench',
    	markerColor: 'blue',
    	iconColor: 'black'
  	});
  	var greenMarker = L.AwesomeMarkers.icon({
    	prefix: 'fa',
    	icon: 'building-o',
    	markerColor: 'blue',
    	iconColor: 'black'
  	});

  	var markers = L.markerClusterGroup();
	var markerList = [];

  	d3.csv("data/ZayoHackathonData_Buildings.csv", function(data) {
  		for( var i = 0; i<data.length; i++ ){
	  			var obj = data[i];
	  			var marker;
	  			if( obj['Latitude'] !== '' && obj['Longitude'] !== ''){
		  			if( obj['On Zayo Network Status'] === 'Not on Zayo Network' ){
		  				marker = L.marker([obj['Latitude'], obj['Longitude']], {icon: redMarker}).bindPopup("Network Proximity: " + obj['Network Proximity']);
		  			}
		  			if( obj['On Zayo Network Status'] === 'On Zayo Network' ){
		  				marker = L.marker([obj['Latitude'], obj['Longitude']], {icon: greenMarker}).bindPopup("Network Proximity: On Network");
		  			}
		  			if( obj['On Zayo Network Status'] === 'Build in Progress' ){
		  				marker = L.marker([obj['Latitude'], obj['Longitude']], {icon: yellowMarker}).bindPopup("Network Proximity: " + obj['Network Proximity']);
		  			}
		  			markerList.push(marker);
  				}
  				if ( i === data.length-1){
  					markers.addLayers(markerList);
					map.addLayer(markers);
  				}
  		}
  	} );

</script>

</body>